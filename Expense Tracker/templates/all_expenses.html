{% extends "base.html" %}

{% block content %}
{% set filter_value = request.args.get('filter') %}
{% set from_value = request.args.get('from') %}
{% set to_value = request.args.get('to') %}
{% set has_custom = from_value and to_value %}

<div class="page-header">
    <div>
        <h1>All Expenses</h1>
        <p class="muted">Review every expense in one place.</p>
    </div>
    <div class="total-pill">
        Total: <span>&#8377; {{ total }}</span>
    </div>
</div>

<div class="filters">
    <div class="filter-group">
        <a href="/expenses" class="filter-btn {% if not filter_value and not has_custom %}active{% endif %}">All</a>
        <a href="/expenses?filter=week" class="filter-btn {% if filter_value == 'week' %}active{% endif %}">Last Week</a>
        <a href="/expenses?filter=month" class="filter-btn {% if filter_value == 'month' %}active{% endif %}">Last Month</a>
        <a href="/expenses?filter=year" class="filter-btn {% if filter_value == 'year' %}active{% endif %}">Last Year</a>
    </div>

    <form method="get" action="/expenses" class="custom-filter custom-filter--inline">
        <div class="date-field">
            <label for="from-date">From</label>
            <input id="from-date" type="date" name="from" value="{{ from_value or '' }}" required>
        </div>

        <div class="date-field">
            <label for="to-date">To</label>
            <input id="to-date" type="date" name="to" value="{{ to_value or '' }}" required>
        </div>

        <button type="submit" class="btn btn-ghost">Apply</button>
    </form>
</div>

<div class="panel table-card">
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Item</th>
                <th>Category</th>
                <th>Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for expense in expenses %}
            <tr>
                <td data-label="Date">{{ expense['date'] | pretty_date }}</td>
                <td data-label="Item">{{ expense['item'] }}</td>
                <td data-label="Category"><span class="chip" style="{{ expense['category'] | category_style }}">{{ expense['category'] }}</span></td>
                <td data-label="Amount">&#8377; {{ expense['amount'] }}</td>
                <td data-label="Actions" class="row-actions">
                    <a href="/edit/{{ expense['id'] }}" class="icon-btn" aria-label="Edit expense">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M4 20h4l10-10a2.8 2.8 0 0 0-4-4L4 16v4z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                            <path d="M13.5 6.5l4 4" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                        </svg>
                    </a>
                    <a href="/delete/{{ expense['id'] }}"
                       class="icon-btn danger"
                       aria-label="Delete expense"
                       onclick="return confirm('Are you sure you want to delete this expense?')">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M5 7h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                            <path d="M9 7V5h6v2" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                            <path d="M7 7l1 12h8l1-12" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
